<!DOCTYPE html>
<html lang="ja">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </title>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
Â  <style>
Â  Â  /* =================================
Â  Â  Â  Â  1. CSSå¤‰æ•° (ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ)
Â  Â  Â  Â  ================================= */
Â  Â  :root {
Â  Â  Â  --primary-color: #007B8C; /* æ·±ã„é’ç·‘ */
Â  Â  Â  --secondary-color: #00B1AD; /* æ˜ã‚‹ã„é’ç·‘ */
Â  Â  Â  --accent-color: #FF7043; /* ã‚ªãƒ¬ãƒ³ã‚¸ */
Â  Â  Â  --background-color: #f0f2f5;
Â  Â  Â  --card-background: #ffffff;
Â  Â  Â  --text-color: #333333;
Â  Â  Â  --light-text-color: #666666;
Â  Â  Â  --border-color: #e0e0e0;
Â  Â  Â  --shadow-medium: 0 8px 25px rgba(0,0,0,0.12);
Â  Â  Â  --success-color: #28a745;
Â  Â  Â  --error-color: #dc3545;
Â  Â  }

Â  Â  /* =================================
Â  Â  Â  Â  2. ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
Â  Â  Â  Â  ================================= */
Â  Â  * { box-sizing: border-box; }
Â  Â  body {
Â  Â  Â  font-family: 'Noto Sans JP', 'Inter', sans-serif;
Â  Â  Â  background: var(--background-color);
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 20px;
Â  Â  Â  display: flex; justify-content: center; align-items: center; min-height: 100vh;
Â  Â  Â  color: var(--text-color);
Â  Â  }
Â  Â  .container {
Â  Â  Â  background: var(--card-background);
Â  Â  Â  border-radius: 20px;
Â  Â  Â  box-shadow: var(--shadow-medium);
Â  Â  Â  padding: 40px;
Â  Â  Â  max-width: 600px;
Â  Â  Â  width: 100%;
Â  Â  }

Â  Â  /* --- ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£ã¨ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  --- */
Â  Â  h2 { font-size: 32px; margin-top: 0; margin-bottom: 30px; color: var(--primary-color); text-align: center; }
Â  Â  /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— */
Â  Â  h3 { 
Â  Â  Â  font-size: 24px; margin-top: 35px; margin-bottom: 18px; color: var(--primary-color); font-weight: 600; 
Â  Â  Â  display: flex; align-items: center; 
Â  Â  }
Â  Â  h3::before { content: 'ğŸ‘‰'; font-size: 0.8em; margin-right: 10px; color: var(--secondary-color); }
Â  Â  
Â  Â  label { display: block; margin-top: 20px; font-weight: 600; font-size: 18px; color: var(--light-text-color); margin-bottom: 5px; }
Â  Â  
Â  Â  /* ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
Â  Â  input[type="text"] {
Â  Â  Â  width: 100%; padding: 16px 20px; border-radius: 12px; border: 1px solid var(--border-color); margin-top: 5px; font-size: 18px;
Â  Â  Â  box-shadow: inset 0 1px 4px rgba(0,0,0,0.08); transition: border-color 0.3s;
Â  Â  }
Â  Â  input[type="text"]:focus { border-color: var(--secondary-color); box-shadow: 0 0 0 4px rgba(0, 177, 173, 0.25); outline: none; }

Â  Â  /* =================================
Â  Â  Â  Â  3. æ—¥ä»˜ãƒ»æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«
Â  Â  Â  Â  ================================= */
Â  Â  #dates, #slots { display: grid; gap: 15px; margin-top: 15px; }
Â  Â  #dates { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); } /* æ—¥ä»˜ã¯å¹…åºƒ */
Â  Â  #slots { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); } /* æ™‚é–“ã¯å¹…ç‹­ */
Â  Â  
Â  Â  .date-btn, .slot {
Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 18px 10px; border-radius: 14px;
Â  Â  Â  border: 1px solid var(--border-color); cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center;
Â  Â  Â  font-size: 17px; font-weight: 500; transition: all 0.3s ease-in-out; background-color: var(--card-background);
Â  Â  Â  position: relative;
Â  Â  }
Â  Â  .date-btn .day-of-week { font-size: 0.9em; color: var(--light-text-color); margin-top: 5px; font-weight: 400; }
Â  Â  
Â  Â  /* ãƒ›ãƒãƒ¼/é¸æŠçŠ¶æ…‹ */
Â  Â  .date-btn:hover:not(.selected), .slot:hover:not(.selected):not(.booked) { transform: translateY(-3px); border-color: var(--secondary-color); }
Â  Â  .date-btn.selected, .slot.selected { background: var(--primary-color); color: #fff; border-color: var(--primary-color); transform: translateY(-2px); }
Â  Â  .date-btn.selected .day-of-week { color: rgba(255, 255, 255, 0.8); }
Â  Â  
Â  Â  /* äºˆç´„æ¸ˆã¿ã‚¹ãƒ­ãƒƒãƒˆ */
Â  Â  .slot.booked { background: #e9ecef; color: #999999; cursor: not-allowed; border-color: #d0d0d0; opacity: 0.8; }
Â  Â  .slot.booked::after { content: 'äºˆç´„æ¸ˆ'; position: absolute; bottom: 5px; right: 5px; font-size: 0.7em; font-weight: 600; color: #777; }

Â  Â  /* =================================
Â  Â  Â  Â  4. ãƒœã‚¿ãƒ³ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«
Â  Â  Â  Â  ================================= */
Â  Â  .primary {
Â  Â  Â  display: block; width: 100%; padding: 18px 20px; border-radius: 14px; border: none; background: var(--accent-color);
Â  Â  Â  color: #fff; margin-top: 40px; font-size: 24px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 112, 67, 0.4);
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  .primary:hover:not(:disabled) { background: #E65100; transform: translateY(-3px); }
Â  Â  .primary:disabled { background: #bdbdbd; cursor: not-allowed; opacity: 0.7; }
Â  Â  
Â  Â  /* ã‚¨ãƒ©ãƒ¼/æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
Â  Â  #message { margin-top: 25px; font-size: 18px; font-weight: 600; text-align: center; color: var(--error-color); }
Â  Â  #message.error::before { content: 'âŒ '; font-size: 1.2em; margin-right: 5px; color: var(--error-color); }

Â  Â  /* =================================
Â  Â  Â  Â  5. ãƒ¢ãƒ¼ãƒ€ãƒ« ã‚¹ã‚¿ã‚¤ãƒ«
Â  Â  Â  Â  ================================= */
Â  Â  .modal-overlay {
Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6);
Â  Â  Â  display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px);
Â  Â  Â  opacity: 0; transition: opacity 0.3s ease-in-out;
Â  Â  }
Â  Â  .modal-overlay.active { display: flex; opacity: 1; }
Â  Â  
Â  Â  .modal-content {
Â  Â  Â  background: var(--card-background); padding: 40px; border-radius: 16px; max-width: 450px; width: 90%;
Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); text-align: center; transform: scale(0.8); opacity: 0;
Â  Â  Â  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
Â  Â  }
Â  Â  .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
Â  Â  
Â  Â  .modal-icon { font-size: 4em; color: var(--success-color); margin-bottom: 15px; }
Â  Â  .modal-content h4 { font-size: 28px; color: var(--primary-color); margin-top: 0; margin-bottom: 20px; font-weight: 700; }
Â  Â  
Â  Â  .modal-details {
Â  Â  Â  background: var(--background-color); padding: 15px; border-radius: 10px; margin-bottom: 25px;
Â  Â  Â  font-size: 17px; font-weight: 500; line-height: 1.8;
Â  Â  }
Â  Â  .modal-details strong { color: var(--accent-color); font-weight: 700; font-size: 1.1em; display: block; margin-top: 5px; }
Â  Â  
Â  Â  #modalCloseBtn {
Â  Â  Â  background: var(--secondary-color); color: white; border: none; padding: 12px 25px; border-radius: 10px;
Â  Â  Â  font-size: 18px; font-weight: 600; cursor: pointer; transition: background 0.2s;
Â  Â  }
Â  Â  #modalCloseBtn:hover { background: var(--primary-color); }
Â  </style>
</head>
<body>

<div class="container">
Â  <h2><span>ğŸ“…</span> äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h2>
Â  
Â  Â  <label for="name">ãŠåå‰</label>
Â  <input id="name" type="text" placeholder="ä¾‹: å±±ç”°å¤ªéƒ" autocomplete="name" />

Â  Â  <h3>æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
Â  <div id="dates"></div>

Â  Â  <h3>æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
Â  <div id="slots"></div>

Â  Â  <button id="reserveBtn" class="primary" disabled>äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</button>
Â  <div id="message"></div>
</div>

<div id="reservationModal" class="modal-overlay">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="modal-icon">âœ…</div>
Â  Â  Â  Â  <h4>ã”äºˆç´„ãŒå®Œäº†ã„ãŸã—ã¾ã—ãŸï¼</h4>
Â  Â  Â  Â  <div id="modalDetails" class="modal-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button id="modalCloseBtn">é–‰ã˜ã‚‹</button>
Â  Â  </div>
</div>

<script>
// ======================================================
// 1. è¨­å®š
// ======================================================
// â˜… ã“ã“ã«ã”è‡ªèº«ã® Google Apps Script ã®ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’è¨­å®šã—ã¦ãã ã•ã„ â˜…
const GAS_URL = "https://script.google.com/macros/s/AKfycbyG159HY3ZG8U2eCPiYsSoNmA3WeNCqhWGSl86W72BLP0JGP_Ran8HudGMvnpy0U10F/exec";
// ======================================================

// ======================================================
// 2. DOMè¦ç´ ã®å–å¾—
// ======================================================
const datesEl = document.getElementById('dates');
const slotsEl = document.getElementById('slots');
const reserveBtn = document.getElementById('reserveBtn');
const messageEl = document.getElementById('message');
const nameEl = document.getElementById('name');

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£è¦ç´ 
const modal = document.getElementById('reservationModal');
const modalDetails = document.getElementById('modalDetails');
const modalCloseBtn = document.getElementById('modalCloseBtn');

// çŠ¶æ…‹å¤‰æ•°
let selectedDate = null;
let selectedSlot = null;


// ======================================================
// 3. ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡é–¢æ•°
// ======================================================

/** ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ */
const closeModal = () => {
Â  Â  modal.classList.remove('active');
};

modalCloseBtn.onclick = closeModal;
modal.onclick = (e) => {
Â  Â  // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã®ã¿é–‰ã˜ã‚‹
Â  Â  if (e.target === modal) {
Â  Â  Â  Â  closeModal();
Â  Â  }
};


// ======================================================
// 4. æ—¥ä»˜ãƒ»ã‚¹ãƒ­ãƒƒãƒˆæç”»ãƒ­ã‚¸ãƒƒã‚¯
// ======================================================

// æ—¥ä»˜ã‚’14æ—¥åˆ†ç”Ÿæˆã—æç”»
function renderDates() {
Â  const today = new Date();
Â  datesEl.innerHTML = '';Â 
Â  const dayNames = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
Â  
Â  for (let i = 0; i < 14; i++) {
Â  Â  const d = new Date(today);
Â  Â  d.setDate(today.getDate() + i);
Â  Â  const dateStr = d.toISOString().slice(0, 10); // YYYY-MM-DD
Â  Â  const dayOfWeek = dayNames[d.getDay()];

Â  Â  const btn = document.createElement('div');
Â  Â  btn.className = 'date-btn';
Â  Â  btn.innerHTML = `<div>${dateStr.slice(5).replace('-', '/')}</div><div class="day-of-week">(${dayOfWeek})</div>`;
Â  Â Â 
Â  Â  btn.onclick = () => {
Â  Â  Â  // æ–°ã—ã„æ—¥ä»˜ãŒé¸æŠã•ã‚ŒãŸå ´åˆ
Â  Â  Â  selectedDate = dateStr;
Â  Â  Â  selectedSlot = null; // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
Â  Â  Â  fetchReservations(dateStr); // äºˆç´„çŠ¶æ³ã‚’å†å–å¾—
Â  Â  Â Â 
Â  Â  Â  renderDatesSelected();
Â  Â  Â  updateButton();
Â  Â  Â  messageEl.innerText = '';
Â  Â  Â  messageEl.className = '';
Â  Â  };
Â  Â  datesEl.appendChild(btn);
Â  }
}

// é¸æŠã•ã‚ŒãŸæ—¥ä»˜ãƒœã‚¿ãƒ³ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
function renderDatesSelected() {
Â  [...datesEl.children].forEach(btn => {
Â  Â  const btnDateText = btn.firstElementChild.innerText;Â 
Â  Â  const selectedMonthDay = selectedDate ? selectedDate.slice(5).replace('-', '/') : null;
Â  Â  // YYYY/MM/DDã®MM/DDéƒ¨åˆ†ã§æ¯”è¼ƒ
Â  Â  btn.classList.toggle('selected', selectedMonthDay === btnDateText);
Â  });
}

// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰äºˆç´„çŠ¶æ³ã‚’å–å¾—ã—ã€ã‚¹ãƒ­ãƒƒãƒˆã‚’æç”»
function fetchReservations(dateStr){
Â  messageEl.innerText = 'äºˆç´„çŠ¶æ³ã‚’å–å¾—ä¸­...';
Â  messageEl.className = '';
Â  slotsEl.innerHTML = ''; // ä¸€æ—¦ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢
Â  
Â  fetch(GAS_URL + "?date=" + encodeURIComponent(dateStr))
Â  .then(res=>{
Â  Â  if (!res.ok) throw new Error('Network response was not ok.');
Â  Â  return res.json();
Â  })
Â  .then(data=>{
Â  Â  renderSlots(data, dateStr);
Â  Â  messageEl.innerText = '';Â 
Â  })
Â  .catch(err=>{
Â  Â  console.error("GET error:",err);
Â  Â  messageEl.innerText="äºˆç´„çŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
Â  Â  messageEl.className = 'error';
Â  Â  slotsEl.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">äºˆç´„çŠ¶æ³ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
Â  });
}

// æ™‚é–“æ  (09:00ã€œ17:00, 30åˆ†åˆ»ã¿) ã‚’ç”Ÿæˆ
function generateTimes(){
Â  const out = [];
Â  let start = 9 * 60; // 9:00ã‚’åˆ†æ•°ã§è¡¨ç¾
Â  let end = 17 * 60; // 17:00ã‚’åˆ†æ•°ã§è¡¨ç¾
Â  let step = 30; // 30åˆ†åˆ»ã¿
Â  for(let cur = start; cur <= end; cur += step){
Â  Â  const hh = String(Math.floor(cur / 60)).padStart(2, '0');
Â  Â  const mm = String(cur % 60).padStart(2, '0');
Â  Â  out.push(`${hh}:${mm}`);
Â  }
Â  return out;
}

// æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã®æç”»ãƒ­ã‚¸ãƒƒã‚¯
function renderSlots(reservations, dateStr){
Â  slotsEl.innerHTML='';
Â  if(!dateStr){
Â  Â  slotsEl.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>';
Â  Â  return;
Â  }
Â Â 
Â  const now = new Date();
Â  const todayStr = now.toISOString().slice(0, 10);
Â  const bookedSet = new Set(reservations.map(r=>r.time));
Â Â 
Â  // äºˆç´„å¯èƒ½ãªä¸‹é™æ™‚åˆ» (ç¾åœ¨æ™‚åˆ» + 1æ™‚é–“) ã‚’è¨ˆç®—
Â  const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);Â 
Â  const thresholdMinutes = oneHourLater.getHours() * 60 + oneHourLater.getMinutes();

Â  let hasAvailableSlots = false;

Â  generateTimes().forEach(slot=>{
Â  Â  const btn = document.createElement('div');
Â  Â  btn.className = 'slot';
Â  Â  btn.innerText = slot;

Â  Â  let isPast = false;
Â  Â Â 
Â  Â  // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ãŒä»Šæ—¥ã®å ´åˆã®ã¿ã€æ™‚é–“ã«ã‚ˆã‚‹åˆ¤å®šã‚’è¡Œã†
Â  Â  if(dateStr === todayStr){
Â  Â  Â  const [slotHour, slotMinute] = slot.split(':').map(Number);
Â  Â  Â  const slotMinutes = slotHour * 60 + slotMinute;

Â  Â  Â  // ã‚¹ãƒ­ãƒƒãƒˆã®é–‹å§‹æ™‚åˆ»ãŒã€ç¾åœ¨æ™‚åˆ»+1æ™‚é–“æœªæº€ã§ã‚ã‚Œã°ç„¡åŠ¹ã¨ã™ã‚‹
Â  Â  Â  if (slotMinutes < thresholdMinutes) {
Â  Â  Â  Â  isPast = true;
Â  Â  Â  }
Â  Â  }

Â  Â  if(isPast || bookedSet.has(slot)){
Â  Â  Â  btn.classList.add('booked');
Â  Â  }else{
Â  Â  Â  // äºˆç´„å¯èƒ½ãªã‚¹ãƒ­ãƒƒãƒˆ
Â  Â  Â  btn.onclick=()=>{
Â  Â  Â  Â  selectedSlot=slot;
Â  Â  Â  Â  // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ãŸã‚å†æç”»
Â  Â  Â  Â  renderSlots(reservations,dateStr);
Â  Â  Â  Â  updateButton();
Â  Â  Â  Â  messageEl.innerText = '';
Â  Â  Â  Â  messageEl.className = '';
Â  Â  Â  };
Â  Â  Â  hasAvailableSlots = true;
Â  Â  }
Â  Â  
Â  Â  // é¸æŠä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
Â  Â  if(slot === selectedSlot) btn.classList.add('selected');
Â  Â  
Â  Â  slotsEl.appendChild(btn);
Â  });

Â  // äºˆç´„å¯èƒ½ãªã‚¹ãƒ­ãƒƒãƒˆãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
Â  if (!hasAvailableSlots && bookedSet.size === generateTimes().length) {
Â  Â  slotsEl.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">ã“ã®æ—¥ã¯ã™ã¹ã¦ã®æ™‚é–“å¸¯ãŒäºˆç´„æ¸ˆã¿ã§ã™ã€‚</p>';
Â  } else if (!hasAvailableSlots && dateStr === todayStr && oneHourLater.getHours() >= 17) {
Â  Â  Â  // 1æ™‚é–“å¾Œã®æ™‚åˆ»ãŒ17æ™‚ä»¥é™ã§ã‚ã‚Œã°æœ¬æ—¥çµ‚äº†ã¨è¡¨ç¤º
Â  Â  Â  slotsEl.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">æœ¬æ—¥ã®äºˆç´„æ ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚</p>';
Â  } else if (!hasAvailableSlots) {
Â  Â  Â  slotsEl.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">äºˆç´„å¯èƒ½ãªæ™‚é–“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
Â  }
}

// äºˆç´„ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹åŒ–åˆ¤å®š
function updateButton(){
Â  // åå‰ã€æ—¥ä»˜ã€æ™‚é–“ãŒã™ã¹ã¦å…¥åŠ›/é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã«æœ‰åŠ¹åŒ–
Â  reserveBtn.disabled = !(nameEl.value.trim() && selectedDate && selectedSlot);
}


// ======================================================
// 5. äºˆç´„å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ (ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼)
// ======================================================

// å…¥åŠ›æ™‚ã«ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
nameEl.addEventListener('input', updateButton);

// äºˆç´„ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
reserveBtn.onclick = async () => {
Â  const reservationName = nameEl.value.trim();
Â  const reservationDate = selectedDate;
Â  const reservationTime = selectedSlot;
Â  Â Â 
Â  if (!reservationName || !reservationDate || !reservationTime) {
Â  Â  messageEl.innerText = "åå‰ã€æ—¥ä»˜ã€æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚";
Â  Â  messageEl.className = 'error';
Â  Â  return;
Â  }

Â  messageEl.innerText = 'äºˆç´„ã‚’é€ä¿¡ä¸­...';
Â  messageEl.className = '';
Â  reserveBtn.disabled = true;

Â  const form = new URLSearchParams();
Â  form.append('name', reservationName);
Â  form.append('date', reservationDate);
Â  form.append('time', reservationTime);

Â  try {
Â  Â  const res = await fetch(GAS_URL, {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'},
Â  Â  Â  body: form.toString()
Â  Â  });

Â  Â  if (!res.ok) throw new Error('Network response was not ok.');
Â  Â  
Â  Â  const data = await res.json();

Â  Â  if(data.success){
Â  Â  Â  // äºˆç´„æˆåŠŸæ™‚: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
Â  Â  Â  const formattedDate = reservationDate.replace(/-/g, '/');
Â  Â  Â  modalDetails.innerHTML = `
Â  Â  Â  Â  Â  <p>ã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€<strong>${reservationName}</strong>æ§˜ã€‚</p>
Â  Â  Â  Â  Â  <p>äºˆç´„å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
Â  Â  Â  Â  Â  <strong>
Â  Â  Â  Â  Â  Â  Â  ğŸ—“ æ—¥æ™‚: ${formattedDate}<br>
Â  Â  Â  Â  Â  Â  Â  ğŸ•’ æ™‚é–“: ${reservationTime}
Â  Â  Â  Â  Â  </strong>
Â  Â  Â  `;
Â  Â  Â Â 
Â  Â  Â  modal.classList.add('active');

Â  Â  Â  // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€äºˆç´„çŠ¶æ³ã‚’å†å–å¾—
Â  Â  Â  nameEl.value = '';
Â  Â  Â  selectedSlot = null;
Â  Â  Â  // äºˆç´„ã—ãŸæ—¥ä»˜ã®çŠ¶æ³ã‚’æœ€æ–°ã«ã™ã‚‹
Â  Â  Â  if (selectedDate) {
Â  Â  Â  Â  fetchReservations(selectedDate);
Â  Â  Â  }
Â  Â  Â  updateButton();

Â  Â  }else{
Â  Â  Â  // ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ
Â  Â  Â  messageEl.innerText = data.message || "äºˆç´„ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æã‚Œå…¥ã‚Šã¾ã™ãŒã€å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
Â  Â  Â  messageEl.className = 'error';
Â  Â  Â  reserveBtn.disabled = false;
Â  Â  }
Â  } catch (err) {
Â  Â  // é€šä¿¡ãƒ¬ãƒ™ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ
Â  Â  console.error("POST error:", err);
Â  Â  messageEl.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
Â  Â  messageEl.className = 'error';
Â  Â  reserveBtn.disabled = false;
Â  }
};


// ======================================================
// 6. åˆæœŸåŒ–å®Ÿè¡Œ
// ======================================================
renderDates();
renderSlots([], null); // åˆæœŸçŠ¶æ…‹ã¯æ—¥ä»˜æœªé¸æŠ
updateButton();Â 
</script>
</body>
</html>
